<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	<title> 监控平台模板 | Counter</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
	<meta name="description" content="">
	<meta name="author" content="">

	<link rel="stylesheet" type="text/css" href="css/cloud-admin.css" >
	<link rel="stylesheet" type="text/css"  href="css/themes/default.css" id="skin-switcher" >
	<link rel="stylesheet" type="text/css"  href="css/responsive.css" >

	<link href="font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<!-- JQUERY UI-->
	<link rel="stylesheet" type="text/css" href="js/jquery-ui-1.10.3.custom/css/custom-theme/jquery-ui-1.10.3.custom.min.css" />
	<!-- DATE RANGE PICKER -->
	<link rel="stylesheet" type="text/css" href="js/bootstrap-daterangepicker/daterangepicker-bs3.css" />
	<!-- BOOTSTRAP SWITCH -->
	<link rel="stylesheet" type="text/css" href="js/bootstrap-switch/bootstrap-switch.min.css" />

	<!-- MAGIC SUGGEST -->
	<link rel="stylesheet" type="text/css" href="js/magic-suggest/magicsuggest-1.3.1-min.css" />
	<!-- DATE PICKER -->
	<link rel="stylesheet" type="text/css" href="js/datepicker/themes/default.min.css" />
	<link rel="stylesheet" type="text/css" href="js/datepicker/themes/default.date.min.css" />
	<link rel="stylesheet" type="text/css" href="js/datepicker/themes/default.time.min.css" />
	<!-- DATA PICKER ADD-->
	<link rel="stylesheet" type="text/css" href="jquey-ui-dpadd/jquery-ui-timepicker-addon.css" />
	<!-- XCHARTS -->
	<link rel="stylesheet" type="text/css" href="js/xcharts/xcharts.min.css" />
	<!-- COLOR PICKER -->
	<link rel="stylesheet" type="text/css" href="js/colorpicker/css/colorpicker.min.css" />

</head>
<body>
	<!-- HEADER -->
	<header class="navbar clearfix" id="header">
		<div class="container">
				<div class="navbar-brand">
					<!-- COMPANY LOGO -->
					<a href="counter.html">
						<img src="img/logo/logo.png" alt="Cloud Admin Logo" class="img-responsive" height="30" width="120">
					</a>
					<!-- /COMPANY LOGO -->
					<!-- TEAM STATUS FOR MOBILE -->
					<div class="visible-xs">
						<a href="#" class="team-status-toggle switcher btn dropdown-toggle">
							<i class="fa fa-users"></i>
						</a>
					</div>
					<!-- /TEAM STATUS FOR MOBILE -->
					<!-- SIDEBAR COLLAPSE -->
					<div id="sidebar-collapse" class="sidebar-collapse btn">
						<i class="fa fa-bars" 
							data-icon1="fa fa-bars" 
							data-icon2="fa fa-bars" ></i>
					</div>
					<!-- /SIDEBAR COLLAPSE -->
				</div>

		</div>
	</header>
	<!--/HEADER -->
	<!-- PAGE -->
	<section id="page">
				<!-- SIDEBAR -->
				<div id="sidebar" class="sidebar">
					<div class="sidebar-menu nav-collapse">
						<div class="divide-20"></div>

						<!-- SIDEBAR QUICK-LAUNCH -->
						<!-- <div id="quicklaunch">
						<!-- /SIDEBAR QUICK-LAUNCH -->
						
						<!-- SIDEBAR MENU -->
						<ul>
							<li class="active">
								<a href="counter.html">
								<i class="fa fa-bar-chart-o fa-fw"></i> <span class="menu-text">Counter</span>
								<span class="selected"></span>
								</a>					
							</li>
							<li >
								<a href="gauges.html">
									<i class="fa fa-fw fa-calendar-o"></i> <span class="menu-text">Gauges</span>
									<span class="selected"></span>
								</a>
							</li>
							<li >
								<a href="meters.html">
									<i class="fa fa-sun-o fa-fw"></i> <span class="menu-text">Meters</span>
									<span class="selected"></span>
								</a>
							</li>
							<li >
								<a href="histograms.html">
									<i class="fa fa-columns fa-fw"></i> <span class="menu-text">Histograms</span>
									<span class="selected"></span>
								</a>
							</li>
							<li >
								<a href="timers.html">
									<i class="fa fa-rss fa-fw"></i> <span class="menu-text">Timers</span>
									<span class="selected"></span>
								</a>
							</li>
							<li >
								<a href="healthchecks.html">
									<i class="fa fa-heart fa-fw"></i> <span class="menu-text">Health Checks</span>
									<span class="selected"></span>
								</a>
							</li>

						</ul>
						<!-- /SIDEBAR MENU -->
					</div>
				</div>
				<!-- /SIDEBAR -->
		<div id="main-content">
			<!-- SAMPLE BOX CONFIGURATION MODAL FORM-->
			<div class="modal fade" id="box-config" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				<div class="modal-dialog">
				  <div class="modal-content">
					<div class="modal-header">
					  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					  <h4 class="modal-title">Box Settings</h4>
					</div>
					<div class="modal-body">
					  Here goes box setting content.
					</div>
					<div class="modal-footer">
					  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					  <button type="button" class="btn btn-primary">Save changes</button>
					</div>
				  </div>
				</div>
			  </div>
			<!-- /SAMPLE BOX CONFIGURATION MODAL FORM-->
			<div class="container">
				<div class="row">
					<div id="content" class="col-lg-12">
						<!-- PAGE HEADER-->
						<div class="row">
							<div class="col-sm-12">
								<div class="page-header">
									<!-- STYLER -->
									
									<!-- /STYLER -->
									<!-- BREADCRUMBS -->
									<ul class="breadcrumb">
										<li>
											<i class="fa fa-home"></i>
											<a href="counter.html">Home</a>
										</li>
										<li>Counter - 计数器指标</li>
									</ul>
									<!-- /BREADCRUMBS -->
									<div class="clearfix">
										<h3 class="content-title pull-left">Counter</h3>
									</div>
									<div class="description">包括功能：定时刷新指标、选择时间段查询指标</div>
								</div>
							</div>
						</div>
						<!-- /PAGE HEADER -->

						<!-- SUMMARY -->
						<div class="row">
							<div class="col-md-3">
								<div class="dashbox panel panel-default">
									<div class="panel-body">
										<div class="panel-left blue">
											<i class="fa fa-twitter fa-3x"></i>
										</div>
										<div class="panel-right">
											<div class="number" id="num1"></div>
											<div class="title" id="time1"></div>
												<span class="label label-info">
													接受 <i class="fa fa-arrow-down"></i>
												</span>
										</div>
									</div>
								</div>
							</div>
							<div class="col-md-3">
								<div class="dashbox panel panel-default">
									<div class="panel-body">
										<div class="panel-left blue">
											<i class="fa fa-twitter fa-3x"></i>
										</div>
										<div class="panel-right">
											<div class="number" id="num2"></div>
											<div class="title" id="time2"></div>
												<span class="label label-success ">
												 发送	<i class="fa fa-arrow-up"></i>
												</span>
										</div>
									</div>
								</div>
							</div>
						</div>
						<!-- /SUMMARY -->
						<!-- SUM CHART -->
						<div class="row">
							<div class="col-md-12">

								<!-- BOX -->
								<div class="box border blue">
									<div class="box-title">
										<h4><i class="fa fa-bar-chart-o"></i>监控信息 - 总值</h4>
									</div>
									<div class="box-body">
										<div class="row">
											<div class="col-md-2 btn-group multi">
												<button class="btn btn-default toggled" data-type="line-dotted">折线图</button>
												<button class="btn btn-default" data-type="bar">柱状图</button>
											</div>

										</div>
										<br/>

										<div class="row">
											<div class="col-md-3 multi">
												<label class="col-md-4 control-label" style="font-size: 16px;padding-right: 0px;padding-top: 5px;">起始时间:</label>
												<div class="col-md-8">
													<input id="bgtime" class="form-control datepicker" type="text" name="regular" size="10">
												</div>
											</div>

											<div class="col-md-3 multi">
												<label class="col-md-4 control-label" style="font-size: 16px;padding-right: 0px;padding-top: 5px;">结束时间:</label>
												<div class="col-md-8">
													<input id="endtime" class="form-control datepicker" type="text" name="regular" size="10">
												</div>
											</div>

											<div class="col-md-2 multi">
												<label class="col-md-4 control-label" style="font-size: 16px;padding-right: 0px;padding-top: 5px;">数量:</label>
												<div class="col-md-8">
													<select id='resultNumId' name='resultNumName' class="form-control" style="width: 80px;">
														<option value="10">10</option>
														<option value="20">20</option>
														<option value="50">50</option>
														<option value="100">100</option>
													</select>
												</div>
											</div>

											<div class="col-md-1 multi">
												<button class="btn btn-default" >查询</button>
											</div>

											<div class="col-md-1 multi">
												<button class="btn btn-info" >最新数据监控</button>
											</div>

										</div>

										<div class="divide-10"></div>
										<figure class="chart" id="chart1" style="min-width:250px"></figure>
									</div>
								</div>
								<!-- /BOX -->
							</div>
						</div>
						<!-- /SUM CHART -->

						<!-- TPS CHART -->
						<div class="row">
							<div class="col-md-12">
								<!-- BOX -->
								<div class="box border blue">
									<div class="box-title">
										<h4><i class="fa fa-bar-chart-o"></i>监控信息 - TPS</h4>
									</div>
									<div class="box-body">
										<div class="row">
											<div class="col-md-2 btn-group multi_2">
												<button class="btn btn-default toggled" data-type="line-dotted">折线图</button>
												<button class="btn btn-default" data-type="bar">柱状图</button>
											</div>

										</div>
										<br/>

										<div class="row">

											<div class="col-md-3 multi">
												<label class="col-md-4 control-label" style="font-size: 16px;padding-right: 0px;padding-top: 5px;">时间段:</label>
												<div class="col-md-8">
													<select id='timeRegionId' name='timeRegionName' class="form-control" style="width: 120px;">
														<option value="1">10分钟</option>
														<option value="2">30分钟</option>
														<option value="3">3小时</option>
														<option value="4">1天</option>
														<option value="5">1周</option>
													</select>
												</div>
											</div>

											<div class="col-md-1 multi_2">
												<button class="btn btn-default" >查询</button>
											</div>

											<div class="col-md-1 multi_2">
												<button class="btn btn-info" >最新数据监控</button>
											</div>


										</div>

										<div class="divide-10"></div>
										<figure class="chart" id="chart2" style="min-width:250px"></figure>
									</div>
								</div>
								<!-- /BOX -->
							</div>
						</div>
						<!-- /TPS CHART -->

					</div><!-- /CONTENT-->
				</div>
			</div>
		</div>
	</section>
	<!--/PAGE -->
	<!-- JAVASCRIPTS -->
	<!-- Placed at the end of the document so the pages load faster -->

	<!-- JQUERY -->
	<script src="js/jquery/jquery-2.0.3.min.js"></script>
	<!-- JQUERY UI-->
	<script src="js/jquery-ui-1.10.3.custom/js/jquery-ui-1.10.3.custom.min.js"></script>
	<!-- BOOTSTRAP -->
	<script src="bootstrap-dist/js/bootstrap.min.js"></script>


	<!-- DATE RANGE PICKER -->
	<script src="js/bootstrap-daterangepicker/moment.min.js"></script>

	<script src="js/bootstrap-daterangepicker/daterangepicker.min.js"></script>
	<!-- SLIMSCROLL -->
	<script type="text/javascript" src="js/jQuery-slimScroll-1.3.0/jquery.slimscroll.min.js">
	</script>
	<script type="text/javascript" src="js/jQuery-slimScroll-1.3.0/slimScrollHorizontal.min.js"></script>
	<!-- BLOCK UI -->
	<script type="text/javascript" src="js/jQuery-BlockUI/jquery.blockUI.min.js"></script>
	<!-- D3 -->
	<script type="text/javascript" src="js/d3/d3.v3.min.js"></script>
	<!-- XCHARTS -->
	<script type="text/javascript" src="js/xcharts/xcharts.min.js"></script>
	<!-- DATE PICKER -->
	<script type="text/javascript" src="js/datepicker/picker.js"></script>
	<script type="text/javascript" src="js/datepicker/picker.date.js"></script>
	<script type="text/javascript" src="js/datepicker/picker.time.js"></script>
	<!-- DATE PICKER ADD -->
	<script type="text/javascript" src="jquey-ui-dpadd/jquery-ui-timepicker-addon.js"></script>
	<script type="text/javascript" src="jquey-ui-dpadd/jquery-ui-timepicker-zh-CN.js"></script>
	<!-- COOKIE -->
	<script type="text/javascript" src="js/jQuery-Cookie/jquery.cookie.min.js"></script>
	<!-- CUSTOM SCRIPT -->
	<script src="js/script.js"></script>
	<script>

		var data ;//绘制图表的数据
		var nowtype = 0;

		var data_2;
		var nowtype_2 = 0;

        var myKeyCouples = "[{appname:\"tsdata\",metricskey:\"com.amon.personshare.metrics_mysql.CounterTest.pedding-jobs_1\"}" +
                ",{appname:\"tsdata\",metricskey:\"com.amon.personshare.metrics_mysql.CounterTest.pedding-jobs_2\"}]";

		jQuery(document).ready(function() {

            App.init();

			$("#bgtime").datetimepicker();
			$("#endtime").datetimepicker();

			chart1(); //创建累加值图表
			chart2(); //创建tps图表


			setSingleData_1();
			setSingleData_2();

		});

		//设置单条最新数据(第一个指标)
		function setSingleData_1(){

			$.post("./xcharts/findSingleLeastData.action", {
						appName:'tsdata',
						metricsKey:'com.amon.personshare.metrics_mysql.CounterTest.pedding-jobs_1'
					},
					function(returndata, status) {
						if ("success" == status) {
							var obj = eval(returndata);
							var num = obj.returnNum;
							var time = obj.resultTime;

							$("#num1").html(num);
							$("#time1").html(time);
						}
					});

			setTimeout(setSingleData_1,1000);

		}
		//设置单条最新数据(第二个指标)
		function setSingleData_2(){

			$.post("./xcharts/findSingleLeastData.action", {
						appName:'tsdata',
						metricsKey:'com.amon.personshare.metrics_mysql.CounterTest.pedding-jobs_2'
					},
					function(returndata, status) {
						if ("success" == status) {
							var obj = eval(returndata);
							var num = obj.returnNum;
							var time = obj.resultTime;

							$("#num2").html(num);
							$("#time2").html(time);
						}
					});

			setTimeout(setSingleData_2,1000);

		}

		//将数据从后台取出，置入本地对象中
		function setdata(){
			$.post("./xcharts/findLeastData.action", {
                        keyCouples: myKeyCouples
                    } ,
					function(returndata, status) {
						if ("success" == status) {
							var obj = eval(returndata);
							data = obj.models;
						}
					});
		}

		//将数据从后台取出，置入本地对象中
		function setdata_2(){
			$.post("./xcharts/findDataByDateRegion.action", {
                        keyCouples: myKeyCouples
                    } ,
					function(returndata, status) {
						if ("success" == status) {
							var obj = eval(returndata);
							data_2 = obj.models;
						}
					});
		}

		//chart
		function chart1() {

			var tt = document.createElement('div');
			tt.className = 'ex-tooltip';
			document.body.appendChild(tt);

			//向后台请求数据
			$.post("./xcharts/findLeastData.action", {
                        keyCouples: myKeyCouples
                    } ,
					function(returndata, status) {
						if ("success" == status) {

							var obj = eval(returndata);

							data = obj.models;

							var order = [0, 1, 0, 2],
									i = 0,
									xFormat = d3.time.format.utc("%m-%d %H:%M:%S"),
									chart = new xChart('line-dotted', data[order[i]], '#chart1', {
										axisPaddingTop: 5,
										dataFormatX: function (x) {
											return new Date(x);
										},
										tickFormatX: function (x) {
											return xFormat(x);
										},
										mouseover: function (d, i) {

											var pos = $(this).offset();
											$(tt).css({
												left: (pos.left + 10)+'px',
												top: (pos.top + 10) + 'px'
											});

											$(tt).text("时间："+d3.time.format('%H:%M:%S')(d.x) + ': 数值：' + d.y)
													.show();
										},
										mouseout: function (d, i) {
											$(tt).hide();
										},
										timing: 1250
									}),
									rotateTimer,
									toggles = d3.selectAll('.multi button'),
									t = 3500;

							function updateChart(i) {
								var d = data[i];
								chart.setData(d);
								toggles.classed('toggled', function () {
									return (d3.select(this).attr('data-type') === d.type);
								});
								return d;
							}

							toggles.on('click', function (d, i) {

								if(i==2){//时间选择查询

									clearTimeout(rotateTimer);//不自动刷新数据

									var start = $("#bgtime").val();
									var end = $("#endtime").val();
									var resultNum = $("#resultNumId").val();
									$.post("./xcharts/findDataByTime.action", {
												bgTime:start,
												endTime:end,
												resultNum:resultNum,
												keyCouples: myKeyCouples
											},
											function(returndata, status) {
												if ("success" == status) {
													var obj = eval(returndata);
													data = obj.models;
													updateChart(0);
												}
											});
								}else if(i==3) {//恢复自动刷新功能
									rotateChart();
								}else{
									nowtype = i;
									updateChart(i);
								}

							});

							//进行组合后达到定时刷新页面元素的效果
							function rotateChart() {
								setdata();
								updateChart(nowtype);
								rotateTimer = setTimeout(rotateChart, t);
							}
							rotateTimer = setTimeout(rotateChart, t);

						}
					});

		}

		//tps Chart
		function chart2() {

			//向后台请求数据
			$.post("./xcharts/findDataByDateRegion.action",  {
                        keyCouples: myKeyCouples
                    } ,
					function(returndata, status) {
						if ("success" == status) {

							var obj = eval(returndata);

							data_2 = obj.models;

							var order = [0, 1, 0, 2],
									i = 0,
									xFormat = d3.time.format.utc("%m-%d %H:%M:%S"),
									chart_2 = new xChart('line-dotted', data_2[order[i]], '#chart2', {
										axisPaddingTop: 5,
										dataFormatX: function (x) {
											return new Date(x);
										},
										tickFormatX: function (x) {
											return xFormat(x);
										},
										timing: 1250
									}),
									rotateTimer_2,
									toggles_2 = d3.selectAll('.multi_2 button'),
									t = 3500;

							function updateChart_2(i) {
								var d = data_2[i];
								chart_2.setData(d);
								toggles_2.classed('toggled', function () {
									return (d3.select(this).attr('data-type') === d.type);
								});
								return d;
							}

							toggles_2.on('click', function (d, i) {


								if(i==2){//时间段选择

									clearTimeout(rotateTimer_2);//不自动刷新数据

									var dateRegionType = $("#timeRegionId").val();
									$.post("./xcharts/findDataByDateRegion.action", {
												dateRegionType:dateRegionType,
                                                keyCouples: myKeyCouples
											},
											function(returndata, status) {
												if ("success" == status) {
													var obj = eval(returndata);
													data_2 = obj.models;
													updateChart_2(0);
												}
											});

								}else if(i==3) {//恢复自动刷新功能
									rotateChart_2();
								}else{
									nowtype_2 = i;
									updateChart_2(i);
								}

							});

							//进行组合后达到定时刷新页面元素的效果
							function rotateChart_2() {
								setdata_2();
								updateChart_2(nowtype_2);
								rotateTimer_2 = setTimeout(rotateChart_2, t);
							}
							rotateTimer_2 = setTimeout(rotateChart_2, t);

						}
					});

		}

	</script>


	<!-- /JAVASCRIPTS -->
</body>
</html>